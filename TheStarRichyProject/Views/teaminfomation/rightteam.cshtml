@{
    ViewBag.Title = "ทีมขวา";
    ViewBag.pTitle = "Right Team";
    ViewBag.pageTitle = "ทีมขวา";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <!-- Summary Cards -->
    <div class="col-md-6 mb-3">
        <div class="card summary-card success">
            <div class="card-body">
                <h6 class="text-muted">จำนวนสมาชิก</h6>
                <h3 id="totalMembers" class="mb-0">0</h3>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-3">
        <div class="card summary-card info">
            <div class="card-body">
                <h6 class="text-muted">PV รวม</h6>
                <h3 id="totalPV" class="mb-0">0</h3>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning">
                <h5 class="card-title text-white mb-0">
                    <i class="ri-arrow-right-line"></i> ทีมขวา
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="leftTeamTable">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>รหัส</th>
                                <th>ชื่อ</th>
                                <th>วันที่สมัคร</th>
                                <th>PV</th>
                                <th>สถานะ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr><td colspan="6" class="text-center py-5">กำลังโหลด...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    $(document).ready(function() {
        loadLeftTeam();
    });

    async function loadLeftTeam() {
        try {
            const response = await fetch('/home/GetMemberInfo');
            const data = await response.json();
            const memberInfo = JSON.parse(data);
            const memberCode = memberInfo.memberInfo[0].membercode;

            const teamResponse = await fetch(`/teaminfomation/GetRightTeam?memberCode=${memberCode}`);
            const teamData = await teamResponse.json();

            renderTable(teamData);
            updateSummary(teamData);
        } catch (error) {
            console.error('Error:', error);
            $('#tableBody').html('<tr><td colspan="6" class="text-center text-danger">เกิดข้อผิดพลาด</td></tr>');
        }
    }

    function renderTable(data) {
        const tbody = $('#tableBody');
        tbody.empty();

        if (!data || !Array.isArray(data) || data.length === 0) {
            tbody.html('<tr><td colspan="6" class="text-center">ไม่พบข้อมูล</td></tr>');
            return;
        }

        data.forEach((member, index) => {
            tbody.append(`
                <tr>
                    <td>${index + 1}</td>
                    <td><strong>${member.membercode}</strong></td>
                    <td>${member.idcardname}</td>
                    <td>${formatDate(member.registerdate)}</td>
                    <td><span class="badge bg-warning">${member.personalpv || 0}</span></td>
                    <td><span class="badge bg-warning">Active</span></td>
                </tr>
            `);
        });
    }

    function updateSummary(data) {
        if (!data || !Array.isArray(data)) return;
        
        $('#totalMembers').text(data.length);
        const totalPV = data.reduce((sum, m) => sum + (parseFloat(m.personalpv) || 0), 0);
        $('#totalPV').text(totalPV.toFixed(0));
    }

    function formatDate(dateStr) {
        if (!dateStr) return 'N/A';
        return new Date(dateStr).toLocaleDateString('th-TH');
    }
</script>
}
